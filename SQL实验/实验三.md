

# 实验三



##### Q1:.csv文件导入失败

**A：**

参考实验文档的解决方案，成功解决了这个问题

###### Q2:Cell表导入时，违反了TOTLETILT= ELECTTILT+MECHTILT的约束

A:修改源数据，将不符合条件的记录删除

###### Q3:Cell表导入时，违反了TOTLETILT非空的约束

A:修改源数据，将不符合条件的记录删除

###### Q4:Cell表导入时，违反了LONGITUDE的完整性约束

A:用excel查表，发现没有一行是空的，怀疑是5位小数的约束，于是将数据类型改为float，没有用。

将其非空约束去掉,数据完全导入。**此时再将非空约束加回去，也加不上了**？？？

**原因：在原excel表的3644行的数据类型不对，应该转成int型。**

###### Q5:SecAdjCell表导入时，不能将NULL插入主键：

A：用excel查表，并没有发现空的单元格；

只能将主键约束去掉，导入后，对比记录条数，发现已经全部导入。**此时再将非空约束加回去，也不加不上了？？？**

###### Q6：MROData表导入时，文档给出的主键组并不能唯一区别记录，而且重复项还很多。

A：这里给出两个方案：

- **方案一**：用excel 的“数据-删除重复数据”将主键重复的项删除
- **方案二: ** 用四元组做为主键
- 实验中我采用了方案一；

###### Q7：HandOver表导入时，违反了主键的非空约束。

A:查看excel表，发现最后一行是空的，删除就好了。



###### Q8:SSMS默认不允许修改属性



###### Q9:创建多表视图时，如果添加关联

A: 从一个表的一个属性出发，拉到另一个表的属性，即可



###### Q10:外键约束

![TIM图片20190408154129](C:\Users\xxx\Desktop\TIM图片20190408154129.png)

方法：

```sql
exec sp_helpconstraint '表名'		#查看Cell表的所有约束，找到所有的外键名，建议复制到记事本
alter table test2 
drop constraint 外键名   #删除所有的外键
truncate 表名 		#重新删除
```



##### Q11:导入数据时添加触发器

- ###### 触发器语法

  ```sql
  create trigger 触发器名
  on 表名
  触发器类型(for/after/instead of) 引发触发器的操作(insert/update/delete)
  as 
  begin 
  	//具体操作
  end 
  ```

- ###### 触发器原理

  在执行触发器的过程中会产生两张临时表INSERTED 和DELETED，这两张表的作用简单说就是拿来记录数据的，主我们可以在触发器执行过程中更好的对数据进行操作

   

  - 对表执行INSERT和UPDATE操作时都会在临时表INSERTED中拷贝一份所增加的数据。

  - 对表执行DELETE和UPDATE操作时都会在临时表DELETED中拷贝一份所删除的数据 

  -  对表执行UPDATE操作时，首先把UPDATE前的数据DELETE到DELETED临时表中，然后再把所要更新的数据插入表中，最后把更新后的数据拷贝到INSERTED临时表中

- **该实验中应该使用instead of**

- Note:

  - **instead of 与for ，after的区别：**

    以插入操作为例，instead of遇到插入操作之后 ，直接转去执行触发器里的代码；而after是先完成插入操作之后 ，再去执行触发器的代码

出现的问题：

1. 不小心使用drop将表删了
2. 